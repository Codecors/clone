<html>
<head>
<script src="/socket.io/socket.io.js"></script>
<script>

// connect to nodejs server
var urlarr = window.location.href.split("/");
var server = urlarr[0] + "//" + urlarr[2]
var socket = io.connect(server);

// request guid
socket.emit('guid', {});

// got a guid - store it
var guid = null;
socket.on('guid', function (data) {
    guid = data.value;
});

// send pid and guid to server, and go to appropriate page
function start(destination){
    var pid = document.getElementById('participantid').value;
    var sid = document.getElementById('sessions').value;
    socket.emit('start', { "url": destination, "pid": pid, "session": sid, "guid": guid });
    location.assign(destination + "?uid=" + guid + "&pid=" + pid);
}

</script>

<title>Start page</title>
</head>
<body>
    <h2>Participant ID</h2>
    <p><select id='sessions'>
        <!-- options added dynamically -->
    </select>
        <input id='participantid' type='text'/></p>

    <h2>Select whether to start with wheel or dial:</h2>
    <hr>
    <p>
        <button onclick="start('/wheel')">Wheel</button>
        <button onclick="start('/dial')">Dial</button>
    </p>

<script>
// request sessions from server
socket.emit('sessions', {});
socket.on('sessionlist', function(data){
    sessions = data.list;
    var selector = document.getElementById('sessions');
    for(var i = 0; i < sessions.length; i++){
        var opt = document.createElement('option');
        opt.value = sessions[i];
        opt.innerHTML = sessions[i];
        selector.appendChild(opt);
    }

});
</script>

</body>
